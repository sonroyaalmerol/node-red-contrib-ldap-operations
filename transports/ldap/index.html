<script type="text/x-red" data-template-name="ldap-add in">
  <div class="form-row">
      <label for="node-input-name"><i class="icon-tag"></i> Name</label>
      <input type="text" id="node-input-name" placeholder="Name">
  </div>
  <div class="form-row">
    <label for="node-input-ldap"><i class="fa fa-user"></i> Add new LDAP Server</label>
    <input type="text" id="node-input-ldap">
  </div>
  <div class="form-row">
      <label for="node-input-dn"> DN</label>
      <input type="text" id="node-input-dn" placeholder="CN=jim bob,OU=users,DC=corp,DC=com">
  </div>
  <div class="form-row">
      <label for="node-input-entry"> Entry</label>
      <input type="text" id="node-input-entry" placeholder="[attribute: value]">
  </div>
</script>

<script type="text/javascript">
    RED.nodes.registerType('ldap-add in', {
        category: 'storage-input',
        color: '#AAAA66',
        defaults: {
            name: { value: '' },
            ldap: { type: 'ldap', required: true },
            dn: { value: '' },
            entry: { value: '' }
        },
        inputs: 1,
        outputs: 1,
        icon: 'db.png',
        label: function () {
            return this.name || 'ldap-add';
        },
        labelStyle: function () {
            return this.name ? 'node_label_italic' : '';
        },
    });
</script>


<script type="text/x-red" data-template-name="ldap-del in">
  <div class="form-row">
      <label for="node-input-name"><i class="icon-tag"></i> Name</label>
      <input type="text" id="node-input-name" placeholder="Name">
  </div>
  <div class="form-row">
    <label for="node-input-ldap"><i class="fa fa-user"></i> Add new LDAP Server</label>
    <input type="text" id="node-input-ldap">
  </div>
  <div class="form-row">
      <label for="node-input-dn"> DN</label>
      <input type="text" id="node-input-dn" placeholder="CN=jim bob,OU=users,DC=corp,DC=com">
  </div>
</script>

<script type="text/javascript">
    RED.nodes.registerType('ldap-del in', {
        category: 'storage-input',
        color: '#AAAA66',
        defaults: {
            name: { value: '' },
            ldap: { type: 'ldap', required: true },
            dn: { value: '' }
        },
        inputs: 1,
        outputs: 1,
        icon: 'db.png',
        label: function () {
            return this.name || 'ldap-del';
        },
        labelStyle: function () {
            return this.name ? 'node_label_italic' : '';
        },
    });
</script>

<script type="text/x-red" data-template-name="ldap-update in">
  <div class="form-row">
      <label for="node-input-name"><i class="icon-tag"></i> Name</label>
      <input type="text" id="node-input-name" placeholder="Name">
  </div>
  <div class="form-row">
    <label for="node-input-ldap"><i class="fa fa-user"></i> Add new LDAP Server</label>
    <input type="text" id="node-input-ldap">
  </div>
  <div class="form-row">
    <label for="node-input-operation"><i class="fa fa-wrench"></i> Operation</label>
    <select type="text" id="node-input-operation">
      <option value="replace">Replace</option>
      <option value="add">Add</option>
      <option value="delete">Delete</option>
    </select>
  </div>
  <div class="form-row">
      <label for="node-input-dn"> DN</label>
      <input type="text" id="node-input-dn" placeholder="CN=jim bob,OU=users,DC=corp,DC=com">
  </div>
  <div class="form-row">
      <label for="node-input-attribute"> Attribute</label>
      <input type="text" id="node-input-attribute" placeholder="givenName">
  </div>
  <div class="form-row">
      <label for="node-input-value"> Value</label>
      <input type="text" id="node-input-value" placeholder="tom">
  </div>
</script>

<script type="text/javascript">
    RED.nodes.registerType('ldap-update in', {
        category: 'storage-input',
        color: '#AAAA66',
        defaults: {
            name: { value: '' },
            ldap: { type: 'ldap', required: true },
            operation: { value: 'list', required: true },
            dn: { value: '' },
            attribute: { value: '' },
            value: { value: '' }
        },
        inputs: 1,
        outputs: 1,
        icon: 'db.png',
        label: function () {
            return this.name || 'ldap-update';
        },
        labelStyle: function () {
            return this.name ? 'node_label_italic' : '';
        },
    });
</script>

<script type="text/x-red" data-template-name="ldap-search in">
  <div class="form-row">
      <label for="node-input-name"><i class="icon-tag"></i> Name</label>
      <input type="text" id="node-input-name" placeholder="Name">
  </div>
  <div class="form-row">
    <label for="node-input-ldap"><i class="fa fa-user"></i> Add new LDAP Server</label>
    <input type="text" id="node-input-ldap">
  </div>
  <div class="form-row">
      <label for="node-input-baseDn"> Base DN</label>
      <input type="text" id="node-input-baseDn" placeholder="OU=users,DC=corp,DC=com">
  </div>
  <div class="form-row">
    <label for="node-input-searchScope"><i class="fa fa-search"></i> Search Scope</label>
    <select type="text" id="node-input-searchScope">
      <option value="base">Base</option>
      <option value="one">One</option>
      <option value="sub">Sub</option>
    </select>
  </div>
  <div class="form-row">
      <label for="node-input-filter"> Filter</label>
      <input type="text" id="node-input-filter" placeholder="(objectclass=*)">
  </div>
  <div class="form-row">
      <label for="node-input-attributes"> Attributes</label>
      <input type="text" id="node-input-attributes" placeholder="givenName,firstName,sn">
  </div>
</script>

<script type="text/javascript">
  RED.nodes.registerType('ldap-search in', {
    category: 'storage-input',
    color: '#AAAA66',
    defaults: {
      name: { value: '' },
      ldap: { type: 'ldap', required: true },
      baseDn: { value: '', required: true },
      searchScope: { value: 'list', required: true },
      filter: { value: '(objectclass=*)' },
      attributes: { value: 'givenName,firstName,sn' }
    },
    inputs: 1,
    outputs: 1,
    icon: 'db.png',
    label: function () {
      return this.name || 'ldap-search';
    },
    labelStyle: function () {
      return this.name ? 'node_label_italic' : '';
    },
  });
</script>

<script type="text/x-red" data-template-name="ldap-modifydn in">
  <div class="form-row">
      <label for="node-input-name"><i class="icon-tag"></i> Name</label>
      <input type="text" id="node-input-name" placeholder="Name">
  </div>
  <div class="form-row">
    <label for="node-input-ldap"><i class="fa fa-user"></i> Add new LDAP Server</label>
    <input type="text" id="node-input-ldap">
  </div>
  <div class="form-row">
      <label for="node-input-dn"> Current DN</label>
      <input type="text" id="node-input-dn" placeholder="CN=jim bob,OU=users,DC=corp,DC=com">
  </div>
  <div class="form-row">
      <label for="node-input-newDn"> New DN/RDN</label>
      <input type="text" id="node-input-newDn" placeholder="CN=james robert">
  </div>
  <div class="form-row">
        <input type="checkbox" id="node-input-deleteOldRdn" style="display: inline-block; width: auto; vertical-align: top;">
        <label style="width: auto;" for="node-input-deleteOldRdn"> Delete old RDN</label>
  </div>
</script>

<script type="text/javascript">
    RED.nodes.registerType('ldap-modifydn in', {
        category: 'storage-input',
        color: '#AAAA66',
        defaults: {
            name: { value: '' },
            ldap: { type: 'ldap', required: true },
            dn: { value: '' },
            newDn: { value: '' },
            deleteOldRdn: { value: true }
        },
        inputs: 1,
        outputs: 1,
        icon: 'db.png',
        label: function () {
            return this.name || 'ldap-modifydn';
        },
        labelStyle: function () {
            return this.name ? 'node_label_italic' : '';
        },
        oneditsave: function() {
            this.deleteOldRdn = $("#node-input-deleteOldRdn").prop("checked");
        },
        oneditprepare: function() {
            $("#node-input-deleteOldRdn").prop("checked", this.deleteOldRdn);
        }
    });
</script>

<script type="text/x-red" data-template-name="ldap-compare in">
  <div class="form-row">
      <label for="node-input-name"><i class="icon-tag"></i> Name</label>
      <input type="text" id="node-input-name" placeholder="Name">
  </div>
  <div class="form-row">
    <label for="node-input-ldap"><i class="fa fa-user"></i> Add new LDAP Server</label>
    <input type="text" id="node-input-ldap">
  </div>
  <div class="form-row">
      <label for="node-input-dn"> DN</label>
      <input type="text" id="node-input-dn" placeholder="CN=jim bob,OU=users,DC=corp,DC=com">
  </div>
  <div class="form-row">
      <label for="node-input-attribute"> Attribute</label>
      <input type="text" id="node-input-attribute" placeholder="sn">
  </div>
  <div class="form-row">
      <label for="node-input-value"> Value</label>
      <input type="text" id="node-input-value" placeholder="bob">
  </div>
</script>

<script type="text/javascript">
    RED.nodes.registerType('ldap-compare in', {
        category: 'storage-input',
        color: '#AAAA66',
        defaults: {
            name: { value: '' },
            ldap: { type: 'ldap', required: true },
            dn: { value: '' },
            attribute: { value: '' },
            value: { value: '' }
        },
        inputs: 1,
        outputs: 1,
        icon: 'db.png',
        label: function () {
            return this.name || 'ldap-compare';
        },
        labelStyle: function () {
            return this.name ? 'node_label_italic' : '';
        },
    });
</script>

<script type="text/x-red" data-template-name="ldap-extended in">
  <div class="form-row">
      <label for="node-input-name"><i class="icon-tag"></i> Name</label>
      <input type="text" id="node-input-name" placeholder="Name">
  </div>
  <div class="form-row">
    <label for="node-input-ldap"><i class="fa fa-user"></i> Add new LDAP Server</label>
    <input type="text" id="node-input-ldap">
  </div>
  <div class="form-row">
      <label for="node-input-oid"> OID</label>
      <input type="text" id="node-input-oid" placeholder="1.3.6.1.4.1.4203.1.11.1">
  </div>
  <div class="form-row">
      <label for="node-input-value"> Value</label>
      <input type="text" id="node-input-value" placeholder="">
  </div>
</script>

<script type="text/javascript">
    RED.nodes.registerType('ldap-extended in', {
        category: 'storage-input',
        color: '#AAAA66',
        defaults: {
            name: { value: '' },
            ldap: { type: 'ldap', required: true },
            oid: { value: '' },
            value: { value: '' }
        },
        inputs: 1,
        outputs: 1,
        icon: 'db.png',
        label: function () {
            return this.name || 'ldap-extended';
        },
        labelStyle: function () {
            return this.name ? 'node_label_italic' : '';
        },
    });
</script>

<script type="text/x-red" data-template-name="ldap">
  <div class="form-row">
    <label for="node-config-input-host"><i class="fa fa-bookmark"></i> Host</label>
    <input type="text" id="node-config-input-host" placeholder="localhost" style="width: 40%;" />
    <label for="node-config-input-port" style="margin-left: 10px; width: 35px; "> Port</label>
    <input type="text" id="node-config-input-port" placeholder="22" style="width:45px">
  </div>
  <div class="form-row">
    <label for="node-config-input-username"><i class="fa fa-user"></i> Username</label>
    <input type="text" id="node-config-input-username">
  </div>
  <div class="form-row">
    <label for="node-config-input-password"><i class="fa fa-key"></i> Password</label>
    <input type="password" id="node-config-input-password">
  </div>
  <div class="form-row">
        <input type="checkbox" id="node-config-input-validatecert" style="display: inline-block; width: auto; vertical-align: top;">
        <label style="width: auto;" for="node-config-input-validatecert"> Validate certificate</label></input>
  </div>
</script>

<script type="text/javascript">
    (function() {
        RED.nodes.registerType('ldap', {
            category: 'config',
            defaults: {
                host: { value: 'ldap://localhost', required: true },
                port: { value: '389', required: true, validate: RED.validators.number() },
                validatecert: { value: true, required: true }
            },
            credentials: {
                username: { type: 'text' },
                password: { type: 'password' }
            },
            exportable: false,
            validatecert: true,
            label: function() {
                return this.host || ''
            },
            oneditsave: function() {
              let trimFields = ['username', 'password'];
              // Just in case any whitespace has crept in with the copy-paste of the fields
              trimFields.forEach(function(field) {
                let v = $('#node-config-input-' + field).val();
                v = v.trim();
                $('#node-config-input-' + field).val(v);
                });

                this.validatecert = $("#node-config-input-validatecert").prop("checked");
            },
            oneditprepare: function() {
                $( "#node-config-input-validatecert" ).prop("checked", this.validatecert);
            }
        });
    })();
</script>
